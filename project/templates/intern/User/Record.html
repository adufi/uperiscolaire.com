{% extends 'intern/base.html' %}

{% block styles %}
<link rel="stylesheet" href="/static/styles/User.css" />
{% endblock %}

{% block main %}
<div id="User" class="container">

    <div id="User-status" class="form-status col-sm-12">
        <div class="form-alert alert alert-danger" role="alert"></div>
        <div class="form-alert alert alert-success" role="alert"></div>
    </div>
    
    <div id="Alert" class="col-sm-12">
        <div class="Alert-container">
            <div class="alert alert-primary" role="alert">
                <span class="alert-message"></span>
                <a class="alert-link"></a>
            </div>
            <div class="alert alert-secondary" role="alert">
                <span class="alert-message"></span>
                <a class="alert-link"></a>
            </div>
            <div class="alert alert-success" role="alert">
                <span class="alert-message"></span>
                <a class="alert-link"></a>
            </div>
            <div class="alert alert-danger" role="alert">
                <span class="alert-message"></span>
                <a class="alert-link"></a>
            </div>
            <div class="alert alert-warning" role="alert">
                <span class="alert-message"></span>
                <a class="alert-link"></a>
            </div>
            <div class="alert alert-info" role="alert">
                <span class="alert-message"></span>
                <a class="alert-link"></a>
            </div>
            <div class="alert alert-light" role="alert">
                <span class="alert-message"></span>
                <a class="alert-link"></a>
            </div>
            <div class="alert alert-dark" role="alert">
                <span class="alert-message"></span>
                <a class="alert-link"></a>
            </div>
        </div>
    </div>
        
    <div id="Family" class="wrapper d-none">

        <div class="wrapper-title">
            <p class="title">Fiche familiale 2020-2021</p>
        </div>

        <div class="wrapper-content">

            <div id="main-messages" class="messages">
                <div class="ui success message">
                    <!-- <i class="close icon"></i> -->
                    <div class="header">
                        Notification(s)
                    </div>
                    <ul class="list"></ul>
                </div>
        
                <div class="ui error message">
                    <!-- <i class="close icon"></i> -->
                    <div class="header">
                        Une ou plusieurs erreurs sont présentes
                    </div>
                    <ul class="list"></ul>
                </div>
                
                <div class="ui warning message">
                    <!-- <i class="close icon"></i> -->
                    <div class="header">
                        Attention!
                    </div>
                    <ul class="list"></ul>
                </div>
            </div>

            <div id="Family-status" class="form-status col-sm-12">
                <div class="form-alert alert alert-danger" role="alert"></div>
                <div class="form-alert alert alert-success" role="alert"></div>
            </div>

            <fieldset class="Profile-family col-sm-12">
                <legend>Informations familliales</legend>
            
                <div class="row">
    
                    <div class="form-group col-sm-6">
                        <label for="intel_q1"><b>Quotient <span class="intel_s"></span></b></label>
                        <br />
                        <select id="intel_q1" onchange="intels_listenInputs(this)">
                            <option value="0">-----</option>
                            <option value="1">NE</option>
                            <option value="2">Q2</option>
                            <option value="3">Q1</option>
                        </select>
                    </div>
    
                    <div class="form-group col-sm-6">
                        <label for="intel_q2"><b>Quotient <span class="intel_e"></span></b></label>
                        <br />
                        <select id="intel_q2" onchange="intels_listenInputs(this)">
                            <option value="0">-----</option>
                            <option value="1">NE</option>
                            <option value="2">Q2</option>
                            <option value="3">Q1</option>
                        </select>
                    </div>
    
                    <div class="form-group col-sm-6">
                        <label for="intel_rn"><b>Numéro CAF</b></label>
                        <br />
                        <input id="intel_rn" type="text" placeholder="Numéro CAF"
                            onchange="intels_listenInputs(this)" />
                    </div>
    
                    <!-- <br /> -->
    
                    <!-- <div class="form-group col-sm-6">
                        <label for="intel_is"><b>Société d'assurance</b></label>
                        <br />
                        <input id="intel_is" type="text" placeholder="Nom société d'assurance"
                            onchange="intels_listenInputs(this)" />
                    </div>
    
                    <div class="form-group col-sm-6">
                        <label for="intel_ip"><b>Police d'assurance</b></label>
                        <br />
                        <input id="intel_ip" type="text" placeholder="01234X7"
                            onchange="intels_listenInputs(this)" />
                    </div> -->

                    <div class="form-group col-sm-12 text-right">
                        <button id="Family-Update" class="button button-blue" onclick="intels_update()">Mettre à jour</button>
                    </div>
                </div>
            </fieldset>
        </div>
    </div>

    <div id="Record" class="wrapper">

        <div class="wrapper-title">
            <p class="title">Fiche inscription 2020-2021</p>
        </div>

        <div class="Record-wrapper wrapper-content">
            <div class="row">

                <div id="Record-status" class="form-status col-sm-12">
                    <div class="form-alert alert alert-danger" role="alert"></div>
                    <div class="form-alert alert alert-success" role="alert"></div>
                </div>

                <!-- ANNEE SCOLAIRE -->
                <!-- <fieldset class="col-sm-12 d-non">
                    <legend>Année scolaires (Administrateur)</legend> -->

                    <!-- SCHOOL YEAR -->
                    <!-- <div class="form-group col-sm-6">
                        <label for="record_school_year"><b>2019 - 2020</b></label>
                        <input id="record_school_year" type="radio" onchange="" />
                        <br/>
                    </div>
                </fieldset> -->

                <!-- TEMPLATE -->
                <!-- <fieldset class="col-sm-12 d-non">
                    <legend></legend>

                    <div class="form-group col-sm-6">
                        <label for="record_school_year"><b>2019 - 2020</b></label>
                        <input id="record_school_year" type="radio" onchange="" />
                        <br/>
                    </div>
                </fieldset> -->
                

                <!-- RENSEIGNEMENTS -->
                <fieldset class="col-sm-12 d-non">
                    <legend>Renseignements enfant</legend>
                    
                    <div class="form-group col-sm-12">

                        <div class="row">

                            <div class="form-group col-sm-6">
                                <label for="record_child_last_name"><b>Nom *</b></label>
                                <br/>
                                <input id="record_child_last_name" type="text" placeholder="Nom" onchange="child_inputOnChange(this)" />
                            </div>

                            <div class="form-group col-sm-6">
                                <label for="record_child_first_name"><b>Prénom *</b></label>
                                <br/>
                                <input id="record_child_first_name" type="text" placeholder="Prénom" onchange="child_inputOnChange(this)" />
                            </div>
                
                            <div class="form-group col-sm-6">
                                <label for="record_child_dob"><b>Date de naissance *</b></label>
                                <br/>
                                <input id="record_child_dob" type="date" placeholder="Date de naissance" onchange="child_inputOnChange(this)" />
                            </div>
                            
                            <!-- LIEU DE NAISSANCE -->
                            <div class="form-group col-sm-6">
                                <label for="record_child_birthplace"><b>Lieu de naissance</b></label>
                                <br/>
                                <input id="record_child_birthplace" type="text" placeholder="Lieu de naissance" onchange="child_inputOnChange(this)" />
                            </div>
                
                            <!-- CLASSE -->
                            <div class="form-group col-sm-6">
                                <label for="record_classroom"><b>Classe *</b></label>
                                <br/>
                                <select id="record_classroom" placeholder="Classe" onchange="record_inputOnChange(this)">
                                    <option value="0">----</option>
                                    <option value="1">STP</option>
                                    <option value="2">SP</option>
                                    <option value="3">SM</option>
                                    <option value="4">SG</option>
                                    <option value="5">CP</option>
                                    <option value="6">CE1</option>
                                    <option value="7">CE2</option>
                                    <option value="8">CM1</option>
                                    <option value="9">CM2</option>
                                    <option value="10">6ème</option>
                                </select>
                            </div>
                
                            <!-- ECOLE -->
                            <div class="form-group col-sm-6">
                                <label for="record_school"><b>Ecole *</b></label>
                                <br/>
                                <select id="record_school" placeholder="Ecole" onchange="record_inputOnChange(this)">
                                    <option value="0" default>----</option>
                                    <option value="PRES">Presqu'ile</option>
                                    <option value="EM">Saint-Joseph A - Edouard MARCEAU</option>
                                    <option value="BDP">Bois du Parc - Victor SCHOELCHER</option>
                                    <option value="CHAP">Chapelle - Lise DESIR-CARTESSE</option>
                                    <option value="DUR">Durand - LUC-CAYOL-DURAND</option>
                                    <option value="GOND">Gondeau - Ambroise PALIX</option>
                                    <option value="MDO">Morne des Olives</option>
                                    <option value="HM">Saint-Joseph B - Henri MAURICE</option>
                                    <option value="JM">Jeanne Merton</option>
                                    <option value="AUTRES">Autres</option>
                                </select>
                            </div>
        
                            <!-- GENRE -->
                            <div class="form-group col-sm-6">
                                <label><b>Genre *</b></label>
                                <br/>
                                
                                <div class="form-group col-sm-12">
                                    <label for="record_child_gender_m"><b>Masculin</b></label>
                                    <input id="record_child_gender_m" name="record_child_gender" type="radio" onchange="child_inputOnChange(this)" />
                                </div>
                
                                <div class="form-group col-sm-12">
                                    <label for="record_child_gender_f"><b>Féminin</b></label>
                                    <input id="record_child_gender_f" name="record_child_gender" type="radio" onchange="child_inputOnChange(this)" />
                                </div>
                            </div>
                
                            <!-- TYPE D'ACCUEIL -->
                            <div class="form-group col-sm-6">
                                <label><b>Type d'accueil *</b></label>
                                <br/>
                                
                                <div class="col-sm-12">
                                    <input id="record_accueil_mati" type="checkbox" onchange="record_inputOnChange(this)" />
                                    <label for="record_accueil_mati"><b>Matin/Soir</b></label>
                                </div>
                                
                                <div class="col-sm-12">
                                    <input id="record_accueil_midi" type="checkbox" onchange="record_inputOnChange(this)" />
                                    <label for="record_accueil_midi"><b>Midi</b></label>
                                </div>
                
                                <div class="col-sm-12">
                                    <input id="record_accueil_merc" type="checkbox" onchange="record_inputOnChange(this)" />
                                    <label for="record_accueil_merc"><b>Mercredi</b></label>
                                </div>
                
                                <div class="col-sm-12">
                                    <input id="record_accueil_vacs" type="checkbox" onchange="record_inputOnChange(this)" />
                                    <label for="record_accueil_vacs"><b>Petites et grandes vacances</b></label>
                                </div>
                            </div>
    
                            <!--  -->
                            <div class="form-group col-sm-6">
                                <label for="record_insurance_society"><b>Société d'assurance *</b></label>
                                <br />
                                <input id="record_insurance_society" type="text" placeholder="Nom société d'assurance"
                                    onchange="record_inputOnChange(this)" />
                            </div>
                            
                            <!--  -->
                            <div class="form-group col-sm-6">
                                <label for="record_insurance_policy"><b>Police d'assurance *</b></label>
                                <br />
                                <input id="record_insurance_policy" type="text" placeholder="01234X7"
                                    onchange="record_inputOnChange(this)" />
                            </div>
                        </div>
                    </div>
                </fieldset>
                
                
                <!-- RESPONSABLES -->
                <fieldset class="col-sm-12 d-non">
                    <legend>Responsables légaux</legend>
                    
                    <div class="form-group col-sm-12">
                        
                        <div class="row">
                            
                            <!-- RESP 1 -->
                            <div class="form-group col-sm-6 row">
                                <b class="col-sm-12">Responsable légal n°1</b>
        
                                <!-- NOM -->
                                <div class="form-group col-sm-12">
                                    <label for="record_resp1_last_name"><b>Nom *</b></label>
                                    <br/>
                                    <input id="record_resp1_last_name" type="text" placeholder="Nom" onchange="profile_onChange(this)" />
                                </div>
        
                                <!-- PRENOM -->
                                <div class="form-group col-sm-12">
                                    <label for="record_resp1_first_name"><b>Prénom *</b></label>
                                    <br/>
                                    <input id="record_resp1_first_name" type="text" placeholder="Prénom" onchange="profile_onChange(this)" />
                                </div>

                                <div class="form-group col-sm-12">
                                    <label for="record_resp1_job"><b>Profession</b></label>
                                    <input id="record_resp1_job" type="text" onchange="profile_onChange(this)" />
                                </div>
                                
                                <div class="form-group col-sm-12">
                                    <label><b>Genre *</b></label>
                                    <br/>
                                    
                                    <label for="record_resp1_gender_m"><b>Père</b></label>
                                    <input id="record_resp1_gender_m" name="record_resp1_gender" type="radio" onchange="profile_onChange(this)" />

                                    <label for="record_resp1_gender_f"><b>Mère</b></label>
                                    <input id="record_resp1_gender_f" name="record_resp1_gender" type="radio" onchange="profile_onChange(this)" />

                                    <label for="record_resp1_gender_t"><b>Tuteur</b></label>
                                    <input id="record_resp1_gender_t" name="record_resp1_gender" type="radio" onchange="profile_onChange(this)" />
                                </div>
                                
                                <!-- PHONE CELL -->
                                <div class="form-group col-sm-12">
                                    <label for="record_resp1_phone_cell"><b>Téléphone principal *</b></label>
                                    <br/>
                                    <input id="record_resp1_phone_cell" type="phone" placeholder="0696 12 34 56" onchange="profile_onChange(this)" />
                                </div>
                                
                                <!-- PHONE HOME -->
                                <div class="form-group col-sm-12">
                                    <label for="record_resp1_phone_home"><b>Téléphone fixe</b></label>
                                    <br/>
                                    <input id="record_resp1_phone_home" type="phone" placeholder="0696 12 34 56" onchange="profile_onChange(this)" />
                                </div>
                                
                                <!-- PHONE PRO -->
                                <div class="form-group col-sm-12">
                                    <label for="record_resp1_phone_pro"><b>Téléphone professionel</b></label>
                                    <br/>
                                    <input id="record_resp1_phone_pro" type="phone" placeholder="0696 12 34 56" onchange="profile_onChange(this)" />
                                </div>
                                
                                <!-- EMAIL -->
                                <div class="form-group col-sm-12 d-none">
                                    <label for="record_resp1_email"><b>Email *</b></label>
                                    <br/>
                                    <input id="record_resp1_email" type="email" placeholder="mon.email@mail.fr" onchange="profile_onChange(this)" />
                                </div>
                                
                                <!-- ADDRESS L1 -->
                                <div class="form-group col-sm-12">
                                    <label for="record_resp1_address1"><b>Adresse ligne 1 *</b></label>
                                    <br/>
                                    <input id="record_resp1_address1" type="text" placeholder="Ligne 1" onchange="profile_onChange(this)" />
                                </div>
        
                                <!-- ADDRESS L2 -->
                                <div class="form-group col-sm-12">
                                    <label for="record_resp1_address2"><b>Adresse ligne 2</b></label>
                                    <br/>
                                    <input id="record_resp1_address2" type="text" placeholder="Ligne 2" onchange="profile_onChange(this)" />
                                </div>
                                
                                <!-- CITY -->
                                <div class="form-group col-sm-6">
                                    <label for="record_resp1_city"><b>Commune *</b></label>
                                    <br/>
                                    <select id="record_resp1_city" placeholder="Commune" onchange="city_onChange(this)">
                                        <option value="0" default>Commune</option>
                                        <option value="97216">L'Ajoupa-Bouillon</option>
                                        <option value="97217">Les Anses-d'Arlet</option>
                                        <option value="97218">Basse-Pointe</option>
                                        <option value="97222">Bellefontaine</option>
                                        <option value="97221">Le Carbet</option>
                                        <option value="97222">Case-Pilote</option>
                                        <option value="97223">Le Diamant</option>
                                        <option value="97224">Ducos</option>
                                        <option value="97250">Fonds-Saint-Denis</option>
                                        <option value="97200">Fort-de-France</option>
                                        <option value="97240">Le François</option>
                                        <option value="97218">Grand'Rivière</option>
                                        <option value="97213">Gros-Morne</option>
                                        <option value="97232">Le Lamentin</option>
                                        <option value="97214">Le Lorrain</option>
                                        <option value="97218">Macouba</option>
                                        <option value="97225">Le Marigot</option>
                                        <option value="97290">Le Marin</option>
                                        <option value="97260">Le Morne-Rouge</option>
                                        <option value="97226">Le Morne-Vert</option>
                                        <option value="97250">Le Prêcheur</option>
                                        <option value="97211">Rivière-Pilote</option>
                                        <option value="97215">Rivière-Salée</option>
                                        <option value="97231">Le Robert</option>
                                        <option value="97227">Sainte-Anne</option>
                                        <option value="97228">Sainte-Luce</option>
                                        <option value="97230">Sainte-Marie</option>
                                        <option value="97270">Saint-Esprit</option>
                                        <option value="97212">Saint-Joseph</option>
                                        <option value="97250">Saint-Pierre</option>
                                        <option value="97233">Schœlcher</option>
                                        <option value="97220">La Trinité</option>
                                        <option value="97229">Les Trois-Îlets</option>
                                        <option value="97280">Le Vauclin</option>
                                    </select>
                                </div>

                                <!-- ZIP -->
                                <div class="form-group col-sm-6">
                                    <label for="record_resp1_zip"><b>Code postal</b></label>
                                    <br/>
                                    <input id="record_resp1_zip" type="number" placeholder="Code postal" onchange="" disabled />
                                </div>
                            </div>
        
                            <!-- RESP 2 -->
                            <div class="form-group col-sm-6 row">
                                <b class="col-sm-12">Responsable légal n°2</b>
        
                                <!-- NOM -->
                                <div class="form-group col-sm-12">
                                    <label for="record_resp2_last_name"><b>Nom</b></label>
                                    <br/>
                                    <input id="record_resp2_last_name" type="text" placeholder="Nom" onchange="record_inputOnChange(this)" />
                                </div>
        
                                <!-- PRENOM -->
                                <div class="form-group col-sm-12">
                                    <label for="record_resp2_first_name"><b>Prénom</b></label>
                                    <br/>
                                    <input id="record_resp2_first_name" type="text" placeholder="Prénom" onchange="record_inputOnChange(this)" />
                                </div>

                                <div class="form-group col-sm-12">
                                    <label for="record_resp2_job"><b>Profession</b></label>
                                    <input id="record_resp2_job" type="text" onchange="record_inputOnChange(this)" />
                                </div>
                                
                                <div class="form-group col-sm-12">
                                    <label><b>Genre</b></label>
                                    <br/>
                                    
                                    <label for="record_resp2_gender_m"><b>Père</b></label>
                                    <input id="record_resp2_gender_m" name="record_resp2_gender" type="radio" onchange="record_inputOnChange(this)" />

                                    <label for="record_resp2_gender_f"><b>Mère</b></label>
                                    <input id="record_resp2_gender_f" name="record_resp2_gender" type="radio" onchange="record_inputOnChange(this)" />

                                    <label for="record_resp2_gender_t"><b>Tuteur</b></label>
                                    <input id="record_resp2_gender_t" name="record_resp2_gender" type="radio" onchange="record_inputOnChange(this)" />
                                </div>
                                
                                <!-- PHONE CELL -->
                                <div class="form-group col-sm-12">
                                    <label for="record_resp2_phone_cell"><b>Téléphone principal</b></label>
                                    <br/>
                                    <input id="record_resp2_phone_cell" type="phone" placeholder="0696 12 34 56" onchange="record_inputOnChange(this)" />
                                </div>
                                
                                <!-- PHONE HOME -->
                                <div class="form-group col-sm-12">
                                    <label for="record_resp2_phone_home"><b>Téléphone fixe</b></label>
                                    <br/>
                                    <input id="record_resp2_phone_home" type="phone" placeholder="0696 12 34 56" onchange="record_inputOnChange(this)" />
                                </div>
                                
                                <!-- PHONE PRO -->
                                <div class="form-group col-sm-12">
                                    <label for="record_resp2_phone_pro"><b>Téléphone professionel</b></label>
                                    <br/>
                                    <input id="record_resp2_phone_pro" type="phone" placeholder="0696 12 34 56" onchange="record_inputOnChange(this)" />
                                </div>
                                
                                <!-- EMAIL -->
                                <div class="form-group col-sm-12 d-none">
                                    <label for="record_resp2_email"><b>Email</b></label>
                                    <br/>
                                    <input id="record_resp2_email" type="email" placeholder="mon.email@mail.fr" onchange="record_inputOnChange(this)" />
                                </div>
                                
                                <!-- ADDRESS L1 -->
                                <div class="form-group col-sm-12">
                                    <label for="record_resp2_address1"><b>Adresse ligne 1</b></label>
                                    <br/>
                                    <input id="record_resp2_address1" type="text" placeholder="Ligne 1" onchange="record_inputOnChange(this)" />
                                </div>
        
                                <!-- ADDRESS L2 -->
                                <div class="form-group col-sm-12">
                                    <label for="record_resp2_address2"><b>Adresse ligne 2</b></label>
                                    <br/>
                                    <input id="record_resp2_address2" type="text" placeholder="Ligne 2" onchange="record_inputOnChange(this)" />
                                </div>
                                
                                <!-- CITY -->
                                <div class="form-group col-sm-6">
                                    <label for="record_resp2_city"><b>Commune</b></label>
                                    <br/>
                                    <select id="record_resp2_city" placeholder="Commune" onchange="record_inputOnChange(this)">
                                        <option value="0" default>Commune</option>
                                        <option value="97216">L'Ajoupa-Bouillon</option>
                                        <option value="97217">Les Anses-d'Arlet</option>
                                        <option value="97218">Basse-Pointe</option>
                                        <option value="97222">Bellefontaine</option>
                                        <option value="97221">Le Carbet</option>
                                        <option value="97222">Case-Pilote</option>
                                        <option value="97223">Le Diamant</option>
                                        <option value="97224">Ducos</option>
                                        <option value="97250">Fonds-Saint-Denis</option>
                                        <option value="97200">Fort-de-France</option>
                                        <option value="97240">Le François</option>
                                        <option value="97218">Grand'Rivière</option>
                                        <option value="97213">Gros-Morne</option>
                                        <option value="97232">Le Lamentin</option>
                                        <option value="97214">Le Lorrain</option>
                                        <option value="97218">Macouba</option>
                                        <option value="97225">Le Marigot</option>
                                        <option value="97290">Le Marin</option>
                                        <option value="97260">Le Morne-Rouge</option>
                                        <option value="97226">Le Morne-Vert</option>
                                        <option value="97250">Le Prêcheur</option>
                                        <option value="97211">Rivière-Pilote</option>
                                        <option value="97215">Rivière-Salée</option>
                                        <option value="97231">Le Robert</option>
                                        <option value="97227">Sainte-Anne</option>
                                        <option value="97228">Sainte-Luce</option>
                                        <option value="97230">Sainte-Marie</option>
                                        <option value="97270">Saint-Esprit</option>
                                        <option value="97212">Saint-Joseph</option>
                                        <option value="97250">Saint-Pierre</option>
                                        <option value="97233">Schœlcher</option>
                                        <option value="97220">La Trinité</option>
                                        <option value="97229">Les Trois-Îlets</option>
                                        <option value="97280">Le Vauclin</option>
                                    </select>
                                </div>

                                <!-- ZIP -->
                                <div class="form-group col-sm-6">
                                    <label for="record_resp2_zip"><b>Code postal</b></label>
                                    <br/>
                                    <input id="record_resp2_zip" type="number" placeholder="Code postal" disabled />
                                </div>
                            </div>
                        </div>
                    </div>
                </fieldset>
                
                
                <!-- RECUPERATEURS -->
                <fieldset class="col-sm-12 d-non">
                    <legend>Autres personnes autorisées à récupérer votre enfant</legend>

                    <div class="form-group col-sm-12">
                        
                        <div class="row">
                            
                            <!-- RECUP. 1 -->
                            <div class="form-group col-sm-12 row">
                                <b class="col-sm-12">Personne n°1</b>
                                <div class="form-group col-sm-6">
                                    <label for="record_recup1_names"><b>Nom et Prénom *</b></label>
                                    <input id="record_recup1_names" type="text" placeholder="Nom et Prénom" onchange="record_inputOnChange(this)" />
                                    <br/>
                                </div>

                                <div class="form-group col-sm-6">
                                    <label for="record_recup1_phones"><b>Téléphones *</b></label>
                                    <input id="record_recup1_phones" type="text" placeholder="0696 12 34 56/0696 98 76 54" onchange="record_inputOnChange(this)" />
                                    <br/>
                                </div>

                                <div class="form-group col-sm-6">
                                    <label for="record_recup1_quality"><b>Qualité *</b></label>
                                    <input id="record_recup1_quality" type="text" placeholder="Oncle/Grand-mère" onchange="record_inputOnChange(this)" />
                                    <br/>
                                </div>
                            </div>

                            <!-- RECUP. 2 -->
                            <div class="form-group col-sm-12 row">
                                <b class="col-sm-12">Personne n°2</b>
                                <div class="form-group col-sm-6">
                                    <label for="record_recup2_names"><b>Nom et Prénom</b></label>
                                    <input id="record_recup2_names" type="text" placeholder="Nom et Prénom" onchange="record_inputOnChange(this)" />
                                    <br/>
                                </div>

                                <div class="form-group col-sm-6">
                                    <label for="record_recup2_phones"><b>Téléphones</b></label>
                                    <input id="record_recup2_phones" type="text" placeholder="0696 12 34 56/0696 98 76 54" onchange="record_inputOnChange(this)" />
                                    <br/>
                                </div>

                                <div class="form-group col-sm-6">
                                    <label for="record_recup2_quality"><b>Qualité</b></label>
                                    <input id="record_recup2_quality" type="text" placeholder="Oncle/Grand-mère" onchange="record_inputOnChange(this)" />
                                    <br/>
                                </div>
                            </div>

                            <!-- RECUP. 3 -->
                            <div class="form-group col-sm-12 row">
                                <b class="col-sm-12">Personne n°3</b>
                                <div class="form-group col-sm-6">
                                    <label for="record_recup3_names"><b>Nom et Prénom</b></label>
                                    <input id="record_recup3_names" type="text" placeholder="Nom et Prénom" onchange="record_inputOnChange(this)" />
                                    <br/>
                                </div>

                                <div class="form-group col-sm-6">
                                    <label for="record_recup3_phones"><b>Téléphones</b></label>
                                    <input id="record_recup3_phones" type="text" placeholder="0696 12 34 56/0696 98 76 54" onchange="record_inputOnChange(this)" />
                                    <br/>
                                </div>

                                <div class="form-group col-sm-6">
                                    <label for="record_recup3_quality"><b>Qualité</b></label>
                                    <input id="record_recup3_quality" type="text" placeholder="Oncle/Grand-mère" onchange="record_inputOnChange(this)" />
                                    <br/>
                                </div>
                            </div>
                        </div>
                    </div>
                </fieldset>


                <!-- AUTORISATIONS -->
                <fieldset class="col-sm-12 d-non">
                    <legend>Autorisations</legend>

                    <div class="form-group col-sm-12">
                        
                        <div class="row">
                            
                            <!-- TRANSPORT -->
                            <div class="form-group col-sm-12 row">
                                <b class="col-sm-12">Autorisation de transport pour raison de santé</b>
                                <span class="Record-Description">J'autorise l'UPEEM à remettre mon enfant aux pompiers et/ou au SAMU, afin d'être transporté d'urgence au centre hospitalier le plus proche, en cas de problèmes de santé ou de blessures jugées graves par la directrice de l'accueil périscolaire.</span>
                                <div class="form-group col-sm-6">
                                    <label for="record_auth_transp_y"><b>Oui</b></label>
                                    <input id="record_auth_transp_y" name="record_auth_transp" type="radio" onchange="record_inputOnChange(this)" />

                                    <label for="record_auth_transp_n"><b>Non</b></label>
                                    <input id="record_auth_transp_n" name="record_auth_transp" type="radio" onchange="record_inputOnChange(this)" />
                                </div>
                            </div>

                            <!-- DROIT A L'IMAGE -->
                            <div class="form-group col-sm-12 row">
                                <b class="col-sm-12">Droit à l'image</b>
                                <span class="Record-Description">J'autorise l'UPEEM à photographier et/ou filmer mon enfant au cours des activités périscolaires et extrascolaires dans un cadre strictement pédagogique. Les photographies ne porteront pas atteinte à sa dignité, à sa vie privée et à sa réputation.</span>
                                <div class="form-group col-sm-6">
                                    <label for="record_auth_image_y"><b>Oui</b></label>
                                    <input id="record_auth_image_y" name="record_auth_image" type="radio" onchange="record_inputOnChange(this)" />

                                    <label for="record_auth_image_n"><b>Non</b></label>
                                    <input id="record_auth_image_n" name="record_auth_image" type="radio" onchange="record_inputOnChange(this)" />
                                </div>
                            </div>
                        </div>
                    </div>
                </fieldset>


                <!-- SANITAIRE -->
                <fieldset class="col-sm-12 d-non">
                    <legend>Fiche sanitaire de liaison</legend>

                    <div class="form-group col-sm-12">
                        
                        <div class="row">
                            
                            <!-- VACCIN -->
                            <div class="form-group col-sm-12 row">
                                <b class="col-sm-12">Votre enfant est-il à jour de ses vaccins obligatoires ?</b>
                                <div class="form-group col-sm-6">
                                    <label for="record_health_vaccine_y"><b>Oui</b></label>
                                    <input id="record_health_vaccine_y" name="record_health_vaccine" type="radio" onchange="record_inputOnChange(this)" />

                                    <label for="record_health_vaccine_n"><b>Non</b></label>
                                    <input id="record_health_vaccine_n" name="record_health_vaccine" type="radio" onchange="record_inputOnChange(this)" />
                                </div>
                            </div>

                            <!-- TRAITEMENT MEDICAL -->
                            <div class="form-group col-sm-12 row">
                                <b class="col-sm-12">Votre enfant suit-il un traitement médical ?</b>
                                <div class="form-group col-sm-6">
                                    <label for="record_health_treatment_y"><b>Oui</b></label>
                                    <input id="record_health_treatment_y" name="record_health_treatment" type="radio" onchange="record_inputOnChange(this)" />

                                    <label for="record_health_treatment_n"><b>Non</b></label>
                                    <input id="record_health_treatment_n" name="record_health_treatment" type="radio" onchange="record_inputOnChange(this)" />
                                </div>
                            </div>

                            <!-- MALADIES -->
                            <div class="form-group col-sm-12 row">
                                <b class="col-sm-12">Votre enfant a t'il déjà eu les maladies suivantes ?</b>

                                <div class="col-sm-12">
                                    <label class="col-sm-3">Rubéole</label> 

                                    <label for="record_health_rubeole_y"><b>Oui</b></label>
                                    <input id="record_health_rubeole_y" name="record_health_rubeole" type="radio" onchange="record_inputOnChange(this)" />
                                    <label for="record_health_rubeole_n"><b>Non</b></label>
                                    <input id="record_health_rubeole_n" name="record_health_rubeole" type="radio" onchange="record_inputOnChange(this)" />
                                    <br>
                                </div>                                

                                <div class="col-sm-12">
                                    <label class="col-sm-3">Varicelle</label>
                                    
                                    <label for="record_health_varicelle_y"><b>Oui</b></label>
                                    <input id="record_health_varicelle_y" name="record_health_varicelle" type="radio" onchange="record_inputOnChange(this)" />
                                    <label for="record_health_varicelle_n"><b>Non</b></label>
                                    <input id="record_health_varicelle_n" name="record_health_varicelle" type="radio" onchange="record_inputOnChange(this)" />
                                    <br>
                                </div>
                                
                                <div class="col-sm-12">
                                    <label class="col-sm-3">Angine</label>
                                    
                                    <label for="record_health_angine_y"><b>Oui</b></label>
                                    <input id="record_health_angine_y" name="record_health_angine" type="radio" onchange="record_inputOnChange(this)" />
                                    <label for="record_health_angine_n"><b>Non</b></label>
                                    <input id="record_health_angine_n" name="record_health_angine" type="radio" onchange="record_inputOnChange(this)" />
                                    <br>
                                </div>
                                
                                <div class="col-sm-12">
                                    <label class="col-sm-3">Rhumatisme articulaire</label>

                                    <label for="record_health_rhumatisme_y"><b>Oui</b></label>
                                    <input id="record_health_rhumatisme_y" name="record_health_rhumatisme" type="radio" onchange="record_inputOnChange(this)" />
                                    <label for="record_health_rhumatisme_n"><b>Non</b></label>
                                    <input id="record_health_rhumatisme_n" name="record_health_rhumatisme" type="radio" onchange="record_inputOnChange(this)" />
                                    <br>
                                </div>
                                
                                <div class="col-sm-12">
                                    <label class="col-sm-3">Scarlatine</label>

                                    <label for="record_health_scarlatine_y"><b>Oui</b></label>
                                    <input id="record_health_scarlatine_y" name="record_health_scarlatine" type="radio" onchange="record_inputOnChange(this)" />
                                    <label for="record_health_scarlatine_n"><b>Non</b></label>
                                    <input id="record_health_scarlatine_n" name="record_health_scarlatine" type="radio" onchange="record_inputOnChange(this)" />
                                    <br>
                                </div>
                                
                                <div class="col-sm-12">
                                    <label class="col-sm-3">Coqueluche</label>

                                    <label for="record_health_coqueluche_y"><b>Oui</b></label>
                                    <input id="record_health_coqueluche_y" name="record_health_coqueluche" type="radio" onchange="record_inputOnChange(this)" />
                                    <label for="record_health_coqueluche_n"><b>Non</b></label>
                                    <input id="record_health_coqueluche_n" name="record_health_coqueluche" type="radio" onchange="record_inputOnChange(this)" />
                                    <br>
                                </div>
                                
                                <div class="col-sm-12">
                                    <label class="col-sm-3">Otite</label>

                                    <label for="record_health_otite_y"><b>Oui</b></label>
                                    <input id="record_health_otite_y" name="record_health_otite" type="radio" onchange="record_inputOnChange(this)" />
                                    <label for="record_health_otite_n"><b>Non</b></label>
                                    <input id="record_health_otite_n" name="record_health_otite" type="radio" onchange="record_inputOnChange(this)" />
                                    <br>
                                </div>
                                
                                <div class="col-sm-12">
                                    <label class="col-sm-3">Rougeole</label>

                                    <label for="record_health_rougeole_y"><b>Oui</b></label>
                                    <input id="record_health_rougeole_y" name="record_health_rougeole" type="radio" onchange="record_inputOnChange(this)" />
                                    <label for="record_health_rougeole_n"><b>Non</b></label>
                                    <input id="record_health_rougeole_n" name="record_health_rougeole" type="radio" onchange="record_inputOnChange(this)" />
                                    <br>
                                </div>
                                
                                <div class="col-sm-12">
                                    <label class="col-sm-3">Oreillons</label>

                                    <label for="record_health_oreillons_y"><b>Oui</b></label>
                                    <input id="record_health_oreillons_y" name="record_health_oreillons" type="radio" onchange="record_inputOnChange(this)" />
                                    <label for="record_health_oreillons_n"><b>Non</b></label>
                                    <input id="record_health_oreillons_n" name="record_health_oreillons" type="radio" onchange="record_inputOnChange(this)" />
                                    <br>
                                </div>
                            </div>

                            <!-- ASTHME -->
                            <div class="form-group col-sm-12 row">
                                <b class="col-sm-12">Votre enfant est-il asthmatique ?</b>
                                <div class="form-group col-sm-6">
                                    <label for="record_health_asthme_y"><b>Oui</b></label>
                                    <input id="record_health_asthme_y" name="record_health_asthme" type="radio" onchange="record_inputOnChange(this)" />

                                    <label for="record_health_asthme_n"><b>Non</b></label>
                                    <input id="record_health_asthme_n" name="record_health_asthme" type="radio" onchange="record_inputOnChange(this)" />
                                </div>
                            </div>

                            <!-- ALLERGY DRUG -->
                            <div class="form-group col-sm-12 row">
                                <b class="col-sm-12">Votre enfant fait-il des allergies à certains médicaments ?</b>
                                <div class="form-group col-sm-12">
                                    <label for="record_health_drug_y"><b>Oui</b></label>
                                    <input id="record_health_drug_y" name="record_health_drug" type="radio" onchange="record_inputOnChange(this)" />

                                    <label for="record_health_drug_n"><b>Non</b></label>
                                    <input id="record_health_drug_n" name="record_health_drug" type="radio" onchange="record_inputOnChange(this)" />
                                </div>

                                <div class="form-group col-sm-12">
                                    <label for="record_health_drug_details"><b>Si oui, merci de préciser :</b></label>
                                    <input id="record_health_drug_details" type="text" onchange="record_inputOnChange(this)" />
                                </div>
                            </div>

                            <!-- ALLERGY FOOD -->
                            <div class="form-group col-sm-12 row">
                                <b class="col-sm-12">Votre enfant est-il allergique à certains aliments ?</b>
                                <div class="form-group col-sm-12">
                                    <label for="record_health_food_y"><b>Oui</b></label>
                                    <input id="record_health_food_y" name="record_health_food" type="radio" onchange="record_inputOnChange(this)" />

                                    <label for="record_health_food_n"><b>Non</b></label>
                                    <input id="record_health_food_n" name="record_health_food" type="radio" onchange="record_inputOnChange(this)" />
                                </div>

                                <div class="form-group col-sm-12">
                                    <label for="record_health_food_details"><b>Si oui, merci de préciser les aliments auxquels il est allergique :</b></label>
                                    <input id="record_health_food_details" type="text" onchange="record_inputOnChange(this)" />
                                </div>
                            </div>

                            <!-- MEDECIN -->
                            <div class="form-group col-sm-12 row">
                                <b class="col-sm-12">Médecin traitant</b>
                                <div class="form-group col-sm-6">
                                    <label for="record_health_doctor_names"><b>Nom du médecin traitant de votre enfant :</b></label>
                                    <input id="record_health_doctor_names" type="text" onchange="record_inputOnChange(this)" />
                                </div>

                                <div class="form-group col-sm-6">
                                    <label for="record_health_doctors_phones"><b>Tél du médecin traitant de votre enfant :</b></label>
                                    <input id="record_health_doctors_phones" type="text" onchange="record_inputOnChange(this)" />
                                </div>
                            </div>

                            <!-- PAI -->
                            <div class="form-group col-sm-12 row">
                                <b class="col-sm-12">Votre enfant fait-il l'objet d'un Projet d'Accueil Individualisé ? (PAI)</b>
                                <div class="form-group col-sm-12">
                                    <label for="record_health_pai_y"><b>Oui</b></label>
                                    <input id="record_health_pai_y" name="record_health_pai" type="radio" onchange="record_inputOnChange(this)" />

                                    <label for="record_health_pai_n"><b>Non</b></label>
                                    <input id="record_health_pai_n" name="record_health_pai" type="radio" onchange="record_inputOnChange(this)" />

                                    <label for="record_health_pai_ongoing"><b>En cours d'élaboration</b></label>
                                    <input id="record_health_pai_ongoing" name="record_health_pai" type="radio" onchange="record_inputOnChange(this)" />
                                </div>

                                <div class="form-group col-sm-12">
                                    <label for="record_health_pai_details"><b>Merci d'indiquer ci-dessous ses spécificités (maladie, accident, crises convulsives, hospitalisation, opération, rééducation) en précisant les précautions à prendre.</b></label>
                                    <input id="record_health_pai_details" type="text" onchange="record_inputOnChange(this)" />
                                </div>
                            </div>

                            <!-- LENTILLES -->
                            <div class="form-group col-sm-12 row">
                                <b class="col-sm-12">Votre enfant porte t'il des lentilles ?</b>
                                <div class="form-group col-sm-12">
                                    <label for="record_health_lentilles_y"><b>Oui</b></label>
                                    <input id="record_health_lentilles_y" name="record_health_lentilles" type="radio" onchange="record_inputOnChange(this)" />

                                    <label for="record_health_lentilles_n"><b>Non</b></label>
                                    <input id="record_health_lentilles_n" name="record_health_lentilles" type="radio" onchange="record_inputOnChange(this)" />
                                </div>
                            </div>

                            <!-- LUNETTES -->
                            <div class="form-group col-sm-12 row">
                                <b class="col-sm-12">Votre enfant porte t'il des lunettes ?</b>
                                <div class="form-group col-sm-12">
                                    <label for="record_health_glass_y"><b>Oui</b></label>
                                    <input id="record_health_glass_y" name="record_health_glass" type="radio" onchange="record_inputOnChange(this)" />

                                    <label for="record_health_glass_n"><b>Non</b></label>
                                    <input id="record_health_glass_n" name="record_health_glass" type="radio" onchange="record_inputOnChange(this)" />
                                </div>
                            </div>

                            <!-- AUDIO -->
                            <div class="form-group col-sm-12 row">
                                <b class="col-sm-12">Votre enfant porte t'il des prothèses auditives ?</b>
                                <div class="form-group col-sm-12">
                                    <label for="record_health_audio_y"><b>Oui</b></label>
                                    <input id="record_health_audio_y" name="record_health_audio" type="radio" onchange="record_inputOnChange(this)" />

                                    <label for="record_health_audio_n"><b>Non</b></label>
                                    <input id="record_health_audio_n" name="record_health_audio" type="radio" onchange="record_inputOnChange(this)" />
                                </div>
                            </div>

                            <!-- DENTS -->
                            <div class="form-group col-sm-12 row">
                                <b class="col-sm-12">Votre enfant porte t'il des prothèses ou autres appareils dentaires ?</b>
                                <div class="form-group col-sm-12">
                                    <label for="record_health_tooth_y"><b>Oui</b></label>
                                    <input id="record_health_tooth_y" name="record_health_tooth" type="radio" onchange="record_inputOnChange(this)" />

                                    <label for="record_health_tooth_n"><b>Non</b></label>
                                    <input id="record_health_tooth_n" name="record_health_tooth" type="radio" onchange="record_inputOnChange(this)" />
                                </div>
                            </div>

                            <!-- AUTRES -->
                            <div class="form-group col-sm-12 row">
                                <b class="col-sm-12">Autres recommandations (qualité de peau, crème solaire)</b>
                                <div class="form-group col-sm-12">
                                    <input id="record_health_others" type="text" onchange="record_inputOnChange(this)" />
                                </div>
                            </div>
                        </div>
                    </div>
                </fieldset>

                
                <!-- AUTORISATIONS ALSH -->
                <fieldset class="col-sm-12 d-non">
                    <legend>Autorisations centre de loisirs</legend>

                    <div class="form-group col-sm-12">
                        
                        <div class="row">
                            
                            <!-- SPORT -->
                            <div class="form-group col-sm-12 row">
                                <b class="col-sm-12">J'autorise mon enfant à participer aux activités physiques et sportives :</b>
                                <div class="form-group col-sm-6">
                                    <label for="record_auth_sport_y"><b>Oui</b></label>
                                    <input id="record_auth_sport_y" name="record_auth_sport" type="radio" onchange="record_inputOnChange(this)" />

                                    <label for="record_auth_sport_n"><b>Non</b></label>
                                    <input id="record_auth_sport_n" name="record_auth_sport" type="radio" onchange="record_inputOnChange(this)" />
                                </div>
                            </div>

                            <!-- BAIGNADE -->
                            <div class="form-group col-sm-12 row">
                                <b class="col-sm-12">J'autorise mon enfant à participer aux baignades surveillées :</b>
                                <div class="form-group col-sm-6">
                                    <label for="record_auth_bath_y"><b>Oui</b></label>
                                    <input id="record_auth_bath_y" name="record_auth_bath" type="radio" onchange="record_inputOnChange(this)" />

                                    <label for="record_auth_bath_n"><b>Non</b></label>
                                    <input id="record_auth_bath_n" name="record_auth_bath" type="radio" onchange="record_inputOnChange(this)" />
                                </div>
                            </div>

                            <!-- TRANSPORT -->
                            <div class="form-group col-sm-12 row">
                                <b class="col-sm-12">Autorisation de transport en véhicule de service et car de location :</b>
                                <div class="form-group col-sm-6">
                                    <label for="record_auth_transpbus_y"><b>Oui</b></label>
                                    <input id="record_auth_transpbus_y" name="record_auth_transpbus" type="radio" onchange="record_inputOnChange(this)" />

                                    <label for="record_auth_transpbus_n"><b>Non</b></label>
                                    <input id="record_auth_transpbus_n" name="record_auth_transpbus" type="radio" onchange="record_inputOnChange(this)" />
                                </div>
                            </div>
                        </div>
                    </div>
                </fieldset>

                
                <!-- END -->
                <fieldset class="col-sm-12 d-non">
                    <legend>Formalisation de l'inscription de votre enfant</legend>

                    <div class="form-group col-sm-12">
                        
                        <p class="Record-Agreement">
                            <div class="card schoolcard">
                                <div class="card-body">
                                    {% if content %}
                                        {{ content.content.html|safe }}
                                    {% endif %}
                                </div>
                            </div>
                        </p>

                        <div class="row">
                            
                            <!-- AGREEMENT -->
                            <div class="col-sm-12 row d-flex align-items-center">
                                <input id="record_agreement" class="col-sm-1" type="checkbox" onchange="record_inputOnChange(this)" />
                                <label for="record_agreement" class="col-sm-11"><b>En soumettant ce formulaire, j'accepte que les informations saisies soient exploitées dans le cadre de la demande d'inscription et de la relation commerciale qui peut en découler.</b></label>
                        </div>
                    </div>
                </fieldset>

                <div class="form-group col-sm-12 text-right">
                    <button id="Record-Create" class="button button-blue" onclick="updateRecord()">Inscrire</button>
                    <button id="Record-Update" class="button button-blue" onclick="updateRecord()">Mettre à jour</button>
                    <button id="Record-Print" class="button button-yellow" onclick="printRecord()">Imprimer fiche d'inscription</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block body_extensions %}
{% endblock %}

{% block scripts %}
<script src="/static/scripts/User/UserDashboard.js"></script>
<script src="/static/scripts/messages.js"></script>
<script>
    let error = false;
    let isAdmin = false;
    let isChild = false;

    let schoolYears = undefined;
    
    // const user_id = {% if pk %} { { pk } } {% else %} 0 {% endif %};
    // const parent_id = {% if pk %} { { pk } } {% else %} 0 {% endif %};
    
    const child_id = {% if child %} {{ child }} {% else %} 0 {% endif %};
    const record_id = {% if record %} {{ record }} {% else %} 0 {% endif %};

    const child = new User();
    const parent = new User();
    const intel = new Intel();
    const sibling = new Sibling();

    let record = undefined;
    const records = new Records();
    
    // const userHelper = new User();
    // const intelsHelper = new Intels(parent_id);
    // const siblingHelper = new Sibling();

    const recordHelper = new Record();
    const recordsHelper = new Records();

    var _child = undefined;
    var _parent = undefined;
    var _sibling = undefined;
    
    window.onload = function (e) {
        default_container = 'Family';

        App.exec(
            () => {
                return new Promise((res, rej) => {
                    run();
                    res();
                })
            },
            {loginRequired: true}
        );
        return;

        // App.init();
        // App.SchoolYears();
        // Alert.init();
        // Login.init();

        schoolYears = App._SchoolYears_unordered;

        if (!child_id) {
            statusDanger('ID enfant non défini.');
            return false;
        }

        // TODO
        // Check App Schoolyears
        if (!schoolYears.length) {
            statusDanger('Echec lors de la récupération des années scolaires.');
            return false
        }

        return run();
    }


    function statusDanger(message) {
        Alert.alertDanger(message);
        return;
        const base = document.getElementById('User-status');

        base.querySelectorAll('.form-alert').forEach(item => { item.classList.remove('show'); });

        const _ = base.querySelector('.form-alert.alert-danger');
        _.innerHTML = message;
        _.classList.add('show');
    }


    function statusSuccess(message) {
        Alert.hide();
        Alert.alertSuccess(message);
        return;
        const base = document.getElementById('User-status');

        base.querySelectorAll('.form-alert').forEach(item => { item.classList.remove('show'); });

        const _ = base.querySelector('.form-alert.alert-success');
        _.innerHTML = message;
        _.classList.add('show');
    }
    

    function family_statusDanger(message) {
        const base = document.getElementById('Family-status');

        base.querySelectorAll('.form-alert').forEach(item => { item.classList.remove('show'); });

        const _ = base.querySelector('.form-alert.alert-danger');
        _.innerHTML = message;
        _.classList.add('show');
    }


    function family_statusSuccess(message) {
        const base = document.getElementById('Family-status');

        base.querySelectorAll('.form-alert').forEach(item => { item.classList.remove('show'); });

        const _ = base.querySelector('.form-alert.alert-success');
        _.innerHTML = message;
        _.classList.add('show');
    }
    

    function record_statusDanger(message) {
        Alert.alertDanger(message);
        return;
        const base = document.getElementById('Record-status');

        base.querySelectorAll('.form-alert').forEach(item => { item.classList.remove('show'); });

        const _ = base.querySelector('.form-alert.alert-danger');
        _.innerHTML = message;
        _.classList.add('show');
    }


    function record_statusSuccess(message) {
        Alert.hide();
        Alert.alertSuccess(message);
        return;
        const base = document.getElementById('Record-status');

        base.querySelectorAll('.form-alert').forEach(item => { item.classList.remove('show'); });

        const _ = base.querySelector('.form-alert.alert-success');
        _.innerHTML = message;
        _.classList.add('show');
    }
    

    function run () {
        schoolYears = App.schoolYears;

        // readUserByID(
        //     child_id,
        //     readUser_onSuccess,
        //     readUser_onFailure
        // );

        child.readUser(
            child_id,
            readUser_onSuccess,
            readUser_onFailure
        );

        // sibling.readByChild(
        //     child_id,
        //     readSibling_onSuccess,
        //     readSibling_onFailure
        // );

        readSiblingByChild(
            child_id,
            readSibling_onSuccess,
            readSibling_onFailure
        );

        records.readByChild(
            child_id,
            readRecords_onSuccess,
            readRecords_onFailure
        );



        return true;
    }


    function readUser_onSuccess(data) {

        userProfile = data.user;

        // Check role
        error = true;
        // Parent
        if (userProfile.roles) {
            for (const role of userProfile.roles) {
                if (role.slug === 'child')
                    isChild = true;
            }
            error = false;
        }
        // Caster
        if (App.caster.roles) {
            for (const role of App.caster.roles) {
                if (role.slug === 'admin')
                    isAdmin = true;
            }
            error = false;
        }

        if (error) {
            //
        }

        child.html_updateRecord();


        // const r = renderRecord();

        // HOTFIX
        // 
        // _child = user;

        // document.getElementById('record_child_last_name').value = user.last_name;
        // document.getElementById('record_child_first_name').value = user.first_name;

        // document.getElementById('record_child_dob').value = user.dob;
        // document.getElementById('record_child_birthplace').value = user.birthplace;

        // document.getElementById('record_child_first_name').value = user.first_name;
        // document.getElementById('record_child_first_name').value = user.first_name;
        
        // switch (user.gender) {
        //     case 1:
        //         document.getElementById('record_child_gender_m').checked = true;
        //         break;

        //     case 2:
        //         document.getElementById('record_child_gender_f').checked = true;
        //         break;

        //     case 3:
        //         document.getElementById('record_child_gender_t').checked = true;
        //         break;

        //     default:
        //         break;
        // } 
    }


    function readUser_onFailure(err) {
        console.log(err);
        let message = 'Une erreur est survenue';
        if (err.erreur) {
            message = err.erreur;
        }
        else if (err.message) {
            message = err.message;
        }
        statusDanger(message);
    }

    /**
     *  Update intels
     *  Get parent data 
     */
    function readSibling_onSuccess(sibling) {
        _sibling = sibling
        // parent_id = data.sibling.parent;

        // Update intel
        let active_sy = undefined;
        for (const sy of schoolYears) {
            if (sy.is_active) {
                active_sy = sy;
                break;
            }
        }

        if (active_sy) {
            for (const _intel of sibling.intels) {
                if (_intel.school_year === active_sy.id) {
                    intel.fromIntel(_intel);
                    intel.fromSchoolYear(active_sy);
                    break;
                }
            }

            if (!isAdmin) {
                document.getElementById('intel_q1').parentElement.style = 'display: none';
                document.getElementById('intel_q2').parentElement.style = 'display: none';
            }

            if (intel.id) {
                document.getElementById('intel_q1').value = intel.quotient_1;
                document.getElementById('intel_q2').value = intel.quotient_2;

                document.getElementById('intel_rn').value = intel.recipent_number;
                // document.getElementById('intel_is').value = intel.insurance_society;
                // document.getElementById('intel_ip').value = intel.insurance_policy;
            }
            else {
                document.getElementById('Record-Create').style = 'display: none';
                document.getElementById('Record-Update').style = 'display: none';

                // family_statusDanger('Veuillez mettre vos informations à jour avant de pouvoir inscrire votre enfant.');
                Alert.alertDanger('Veuillez mettre vos informations à jour avant de pouvoir inscrire votre enfant.');
            }
        }

        // Update parent
        parent.readUser(
            sibling.parent,
            (data) => {
                parent.html_updateParentRecord();
            },
            (err) => {
                console.log(err);
                // record_statusDanger(err);
                Alert.alertDanger(err);
            }
        );

        return;

        readUserByID(
            sibling.parent,
            (user) => {
                _parent = user;

                document.getElementById('record_resp1_last_name').value = user.last_name;
                document.getElementById('record_resp1_first_name').value = user.first_name;

                document.getElementById('record_resp1_job').value = user.job;

                if (user.hasOwnProperty('phones') && user.phones) {
                    document.getElementById('record_resp1_phone_cell').value = user.phones.phone_cell;
                    document.getElementById('record_resp1_phone_home').value = user.phones.phone_home;
                    document.getElementById('record_resp1_phone_pro').value = user.phones.phone_pro;
                }
                
                if (user.hasOwnProperty('auth') && user.auth) {
                    document.getElementById('record_resp1_email').value = user.auth.email;
                }

                if (user.hasOwnProperty('addresses') && user.addresses.length) {

                    document.getElementById('record_resp1_zip').value = user.addresses[0]['zip_code'];
                    document.getElementById('record_resp1_city').value = user.addresses[0]['zip_code'];
                    document.getElementById('record_resp1_address1').value = user.addresses[0]['address1'];
                    document.getElementById('record_resp1_address2').value = user.addresses[0]['address2'];
                }

                if (user.gender === 1)
                    document.getElementById('record_resp1_gender_m').checked = true;
                else if (user.gender === 2)
                    document.getElementById('record_resp1_gender_f').checked = true;
                else if (user.gender === 3)
                    document.getElementById('record_resp1_gender_t').checked = true;
            },
            (err) => {
                console.log(err);
                // record_statusDanger(err);
                Alert.alertDanger(err);
            }
        )
    }


    function readSibling_onFailure(err) {
        console.log(err);
        let message = 'Une erreur est survenue';
        if (err.erreur) {
            message = err.erreur;
        }
        else if (err.message) {
            message = err.message;
        }
        family_statusDanger(message);
    }


    /**
     *  Update record data
     */
    function readRecords_onSuccess(data) {
        if (record_id) {
            console.log('Edit');

            for (const _record of Object.values(records.records())) {
                if (_record.id === record_id) {
                    record = _record;
                    break;
                }
            }

            // Hide
            document.getElementById('Record-Create').style = 'display: none';

            Alert.alertSuccess('Votre dossier a bien été enregistré, merci de prendre connaissance des pièces à fournir ainsi que de nos horaires d\'accueil.');
        }
        else {
            console.log('Creation');
            
            record = new Record();
            record.child_id = child_id;

            document.getElementById('Record-Print').style = 'display: none';
            document.getElementById('Record-Update').style = 'display: none';
        }
        
        if (!record) {
            statusDanger ('Erreur lors de la récupération du dossier.');
        }
        else {
            record.html_updateRecordData();
            // renderRecords();
        }
    }


    function readRecords_onFailure(err) {
        console.log(err);
        record_statusDanger(err);
    }


    // Not used - See update
    function createRecord() {
        let r = undefined;

        try {
            const update_response = parent.updateUser(
                (data) => {
                    r = record.create(
                        updateRecord_onSuccess,
                        updateRecord_onFailure
                    );
                },
                update_onFailure
            );

            if (typeof(update_response) === 'string') {
                r = record.create(
                    updateRecord_onSuccess,
                    updateRecord_onFailure
                );
            }
        }
        catch (error) {
            record_statusDanger(error);
        }
    
        if (typeof (r) === 'string')
            record_statusDanger(r);
    }


    /**
     *  Handle creation and update
     * 
     */
    function updateRecord() {
        try {
            record.payload();
        }
        catch (error) {
            Alert.alertDanger(error);
            // record_statusDanger(error);   
            return false;
        }

        // Update child
        child.updateChild(
            (data) => {
                // Update parent 
                parent.updateUser(
                    (data) => {
                        // Update record
                        if (record.id) {
                            r = record.update(
                                updateRecord_onSuccess,
                                updateRecord_onFailure
                            );
                        }
                        else {
                            r = record.create(
                                updateRecord_onSuccess,
                                updateRecord_onFailure
                            );
                        }
                    },
                    update_onFailure
                );
            },
            update_onFailure
        );
        return true;
        
        // Update child
        child.updateUser(
            (data) => {
                console.log('User updated');
                // Update parent 
                parent.updateUser(
                    (data) => {
                        console.log('Parent updated');
                        
                        // Update record
                        try {
                            r = record.update(
                                updateRecord_onSuccess,
                                updateRecord_onFailure
                            );
                        }
                        catch (error) {
                            record_statusDanger(error);
                        }
                    },
                    update_onFailure
                );
            },
            update_onFailure
        );
    }

    
    function printRecord () {
        if (record.id) {
            window.open(`/record/${child.id}/${record.id}/pdf/`);
            window.location.href = `/family/${parent.id}/`;
        }
    }


    function updateRecord_onSuccess(data) {
        Alert.hide();
        Alert.alertSuccess('Informations enregistrées.');
        // statusSuccess('Informations enregistrées.');

        window.setTimeout(
            () => window.location.href = `/record/${child.id}/${data.record.id}`,
            3000
        );
    }


    function updateRecord_onFailure(err) {
        console.log(err);
        let message = 'Une erreur est survenue';
        if (err.erreur) {
            message = err.erreur;
        }
        else if (err.message) {
            message = err.message;
        }
        Alert.alertDanger(message);
        // record_statusDanger(message);
    }


    /*****************************************************************************
     *  RECORD
     *****************************************************************************/

    function renderRecord() {

    }


    function child_inputOnChange (e) {
        const result = child.validate(e.id, e.value);
        console.log(result);

        if (!result.status) {
            inputDanger(e.id);
            record_statusDanger(result.message);
        }
        else {
            inputNeutral(e.id);
        }
    }


    function parent_inputOnChange (e) {}


    function record_inputOnChange (e) {
        console.log(e);
        console.log(e.value);
        
        let result = undefined;

        switch (e.type) {
            case 'radio':
                result = record.validate(e.id, e.checked);
                break;

            case 'select':
                result = record.validate(e.id, e.checked);
                break;

            case 'checkbox':
                result = record.validate(e.id, e.checked);
                break;

            default:
                result = record.validate(e.id, e.value);
                break;
        }
        console.log(result);
        if (!result.status) {
            inputDanger(e.id);
            Alert.alertDanger(result.message);
        }
        else {
            child.change_flag = true;
            parent.change_flag = true;
            inputNeutral(e.id);
            Alert.hide();
        }


    }


    function inputDanger(id) {
        document.getElementById(id).classList.add('error');
    }


    function inputNeutral(id) {
        document.getElementById(id).classList.remove('error');
    }



    /*****************************************************************************
    *  USER - PROFILE
    *****************************************************************************/

    function renderProfile() {
        // Update document title
        document.title = userProfile.last_name + ' ' + userProfile.first_name;

        const userWrapper = document.getElementById('User-wrapper');

        // Set user wrapper title
        userWrapper.querySelector('.title').innerHTML = userProfile.last_name + ' ' + userProfile.first_name;

        // Set imcomplete data status
        if (!userProfile.data_completed) {
            profile_statusDanger('Attention, vos informations sont incomplètes. Veuillez les compléter.');
        }

        // Setup user form
        if (!isChild)
            formUser(userProfile);

        else
            formChild(userProfile);
    }


    function profile_statusDanger(message) {
        Alert.alertDanger(message);
        return;
        const base = document.getElementById('Profile-status');

        base.querySelectorAll('.form-alert').forEach(item => { item.classList.remove('show'); });

        const _ = base.querySelector('.form-alert.alert-danger');
        _.innerHTML = message;
        _.classList.add('show');
    }


    /**
     *  Update form a normal user
     */
    function formUser(user) {
        try {

            USERINPUTS['user_first_name'].value = user.first_name;
            USERINPUTS['user_last_name'].value = user.last_name;

            USERINPUTS['user_job'].value = user.job;
            USERINPUTS['user_dob'].value = user.dob;
            USERINPUTS['user_email'].value = user.email;

            if (user.accept_newsletter) {
                document.getElementById('user_accept_newsletter').checked = true;
            }

            if (user.gender === 1)
                document.getElementById('user_gender_m').checked = true;
            else if (user.gender === 2)
                document.getElementById('user_gender_f').checked = true;
            else if (user.gender === 3)
                document.getElementById('user_gender_t').checked = true;

            USERINPUTS.hide('user_birthplace');

            if (user.phones) {
                USERINPUTS['user_phone_cell'].value = user.phones.cell;
                USERINPUTS['user_phone_home'].value = user.phones.home;
                USERINPUTS['user_phone_pro'].value = user.phones.pro;
            } 

            if (user.address) {
                USERINPUTS['user_address1'].value = user.address.address1;
                USERINPUTS['user_address2'].value = user.address.address2;

                USERINPUTS['user_city'].value = user.address.zip_code;
                USERINPUTS['user_zip_code'].value = user.address.zip_code;
            }
        }
        catch (error) {
            console.log('An error occured in formUser() with message: ' + error);
        }
    }


    /**
     *  Update form a normal user
     */
    function formChild(user) {
        try {
            USERINPUTS['user_first_name'].value = user.first_name;
            USERINPUTS['user_last_name'].value = user.last_name;

            USERINPUTS['user_dob'].value = user.dob;

            // USERINPUTS.hide('user_email');

            // USERINPUTS.hide('user_phone_cell');
            // USERINPUTS.hide('user_phone_home');
            // USERINPUTS.hide('user_phone_pro');

            // USERINPUTS.hide('user_address1');
            // USERINPUTS.hide('user_address2');

            // USERINPUTS.hide('user_city');
            // USERINPUTS.hide('user_zip_code');

            document.querySelector('.Profile-Phones').style = 'display:none';
            document.querySelector('.Profile-Address').style = 'display:none';
        }
        catch (error) {
            console.log('An error occured in formChild() with message: ' + error);
        }
    }


    function inputDanger(id) {
        document.getElementById(id).classList.add('error');
    }


    function inputNeutral(id) {
        document.getElementById(id).classList.remove('error');
    }


    function profile_onChange(e) {
        const result = parent.validate(e.id, e.value);
        console.log(result);

        if (!result.status) {
            inputDanger(e.id);
            record_statusDanger(result.message);
        }
        else {
            inputNeutral(e.id);
        }
    }


    function city_onChange(e) {
        profile_onChange(e);
        if (e.value !== '0') {
            document.getElementById('record_resp1_zip').value = e.value;
        }
    }


    // Not used
    // See updateRecord
    function update() {
        const r = userHelper.updateUser(
            update_onSuccess,
            update_onFailure
        );

        if (typeof (r) === 'string')
            statusDanger(r);
    }


    function update_onSuccess(data) {
        Alert.hide();
        Alert.alertSuccess('Informations enregistrées.');
        // statusSuccess('Informations enregistrées.');
    }


    function update_onFailure(err) {
        console.log(err);
        try {
            if (err.includes('Values can')) {
                Alert.alertDanger('Erreur, informations incomplètes.');
                // profile_statusDanger('Erreur, informations incomplètes.');
            }
        }
        catch (error) {
            console.log(error);
            // Alert.alertDanger(error);
        }
    }


    /*****************************************************************************
     *  INTELS
     *****************************************************************************/

    /** 
     *  renderIntels
     *      Update Intel card
     *      Add school years to History
     *      Update History with Intels
     *      Update card buttons
     */
    function renderIntels() {   
        const card = document.querySelector('.IntelCard');
        const history = document.querySelector('.Intels-History');

        // Render active School Year
        for (const sy of schoolYears) {
            const s = sy.date_start.split('-')[0];
            const e = sy.date_end.split('-')[0];

            if (sy.is_active) {

                // Add years to html
                //
                // Card

                card.querySelector('.IntelCard-card b').innerHTML = `${s} - ${e}`;

                card.querySelector('.intel_s').innerHTML = s;
                card.querySelector('.intel_e').innerHTML = e;

                history.querySelector('.active').innerHTML = siblingHelper.render(sy, isAdmin);
            }

            // Only History
            else {
                history.querySelector('.list').innerHTML += siblingHelper.render(sy, isAdmin);
            }

            // Sanity
            // console.log(`${s} - ${e}`);
        }

        const Q = [
            '-',
            'NE',
            'Q2',
            'Q1'
        ];

        // Intels
        const set_disable = (block, selector, value) => {
            const _ = block.querySelector(selector);
            _.value = value;
            _.disabled = (isAdmin) ? false : true;
        };

        for (const intel of Object.values(siblingHelper.intels())) {

            const block = history.querySelector(`.History-card[data-school="${intel.school_year}"]`);

            if (!block) {
                console.log('Could not find a school year card for intel: ' + intel.id);
                continue;
            }

            // Mark history card
            block.setAttribute('data-intel', intel.id);

            if (intel.is_active) {
                // Update card
                card.querySelector('.Intel-data').style = 'display: inherit';
                card.querySelector('.Intel-no_data').style = 'display: none';

                card.querySelector('.intel_q1').innerHTML = Q[intel.quotient_1];
                card.querySelector('.intel_q2').innerHTML = Q[intel.quotient_2];
                card.querySelector('.intel_rn').innerHTML = intel.recipent_number;
                card.querySelector('.intel_ip').innerHTML = intel.insurance_policy;

                block.querySelector('input[name="intel_rn"]').value = intel.recipent_number;
                block.querySelector('input[name="intel_ip"]').value = intel.insurance_policy;
            }
            else {

                set_disable(block, 'input[name="intel_rn"]', intel.recipent_number);
                set_disable(block, 'input[name="intel_ip"]', intel.insurance_policy);
            }

            block.querySelector('.History-form').style = 'display: flex';
            block.querySelector('.History-no_data').style = 'display: none';

            set_disable(block, 'select[name="intel_q1"]', intel.quotient_1);
            set_disable(block, 'select[name="intel_q2"]', intel.quotient_2);

        }

        // Buttons
        if (siblingHelper.has_active_intel)
            document.getElementById('IntelCard-Add').style = 'display: none';
        else
            document.getElementById('IntelCard-Update').style = 'display: none';

        // Inputs
        document.querySelectorAll('.History-card').forEach((card) => {
            const sy = card.getAttribute('data-school');
            const intel = card.getAttribute('data-intel');

            card.querySelectorAll('input').forEach(input => {
                input.addEventListener('change', () => intels_listenInputs(input, sy, intel));
            });

            card.querySelectorAll('select').forEach(input => {
                input.addEventListener('change', () => intels_listenInputs(input, sy, intel));
            });
        });


    }


    function intels_listenInputs(e, sy_id, intel_id) {
        console.log('intels_listenInputs');
        console.log(e);
        // console.log(sy_id);
        // console.log(intel_id);

        // if (!sy_id) {
        //     console.log('intels_listenInputs() => Error with input: ' + e);
        //     return false;
        // }

        // let intel = null;

        // if (!intel_id) {
        //     if (!intelsAdded[sy_id]) {
        //         intelsAdded[sy_id] = new Intel(parent_id);
        //         intelsAdded[sy_id].school_year = sy_id
        //     }

        //     intel = intelsAdded[sy_id];
        // }
        // else {
        //     intel = siblingHelper.intel(intel_id);

        //     if (!intel) {
        //         console.log('intels_listenInputs() => Failed to get intel with ID: ' + intel_id);
        //         return false;
        //     }
        // }

        // Data validation

        const value = e.value;

        switch (e.localName) {
            case 'input':
                // No values should exceed 20 chars
                if (value.length > 19) {
                    inputDanger(e.id);
                    family_statusDanger('Ce champ contient trop de caractères (20 max.).');
                    return false;
                }
                break;

            case 'select':
                const _ = parseInt(value);
                if (!_) {
                    inputDanger(e.id);
                    family_statusDanger('Veuillez sélectionner un quotient valide.');
                    return false;
                }
                if (_ < 0 || _ > 3) {
                    inputDanger(e.id);
                    family_statusDanger('Veuillez sélectionner un quotient parmi ceux proposés.');
                    return false;
                }
                break;
        }

        switch (e.id) {
            case 'intel_q1':
                intel.quotient_1 = parseInt(value);
                break;

            case 'intel_q2':
                intel.quotient_2 = parseInt(value);
                break;

            case 'intel_rn':
                intel.recipent_number = value;
                break;

            case 'intel_is':
                intel.insurance_society = value;
                break;

            case 'intel_ip':
                intel.insurance_policy = value;
                break;
        }
        intel.has_changed = true;
    }


    function intels_update() {
        return false;
        let r = '';
        if (intel.id) {
            r = intel.update(
                intels_update_onSuccess,
                intels_update_onFailure
            );
        }            
        else {
            r = intel.create(
                intels_update_onSuccess,
                intels_update_onFailure
            );
        }
        if (typeof(r) === 'string') {
            family_statusDanger(r);
        }
    }


    function intels_update_onSuccess(data) {
        window.location.reload();
    }


    function intels_update_onFailure(err) {
        console.log(err);
        let message = 'La mise à jour a échoué.';
        if (err.erreur) {
            message = err.erreur;
        }
        else if (err.message) {
            message = err.message;
        }
        family_statusDanger(message);
    }


    /**************************************************************************************************
     *  CHILDREN
     **************************************************************************************************/

    function renderChildren() {

        for (const child of Object.values(siblingHelper.children())) {
            if (child.id != user_id)
                child.renderCard();
        }

        siblingHelper.renderCardAdd();
    }


    function children_listenInputs(e) {
        const result = childAdded.validate(e.id, e.value);
        console.log(result);

        if (!result.status) {
            inputDanger(e.id);
            children_statusDanger(result.message);
        }
        else {
            inputNeutral(e.id);
        }
    }


    function children_statusDanger(message) {
        const base = document.getElementById('AddChild-status');

        base.querySelectorAll('.form-alert').forEach(item => { item.classList.remove('show'); });

        const _ = base.querySelector('.form-alert.alert-danger');
        _.innerHTML = message;
        _.classList.add('show');
    }


    function createChild() {
        const r = childAdded.createChild(
            createChild_onSuccess,
            createChild_onFailure
        );

        if (typeof (r) === 'string')
            statusDanger(r);
    }


    function createChild_onSuccess(data) {
        console.log(data);
        statusSuccess('Informations enregistrées.');
    }


    function createChild_onFailure(err) {
        console.log(err);
        if (err.includes && err.includes('Values can')) {
            statusDanger('Erreur, informations incomplètes.');
        }
    }


    /*****************************************************************************
     *  RECORDS
     *****************************************************************************/

    /* */
    function renderRecords() {
        if (!isChild)
            return 'User is not a child';

        const wrapper = document.getElementById('Records-wrapper');

        for (const sy of App._SchoolYears_unordered) {

            // Create record wrapper
            if (sy.is_active) {
                const old = wrapper.innerHTML
                wrapper.innerHTML = recordsHelper.renderRecordItem(sy);
                wrapper.innerHTML += old;
            }
            else {

                wrapper.innerHTML += recordsHelper.renderRecordItem(sy);
            }
        }

        for (const record of Object.values(recordsHelper.records())) {
            record.updateRecordItem();
        }
    }


    /**************************************************************************************************
     *  MODALS
     **************************************************************************************************/

    function openModal(id) {
        document.getElementById(id).classList.add('show');
    }


    function closeModal() {
        document.querySelectorAll('.modal').forEach(item => item.classList.remove('show'));
    }


    function postProcess() {
        document.getElementById('user_dob').value = '{{ user.dob | safe }}';
        document.getElementById('user_city').value = '{{ user.address.zip_code | safe }}';
    }
</script>
{% endblock %}